
@{
    ViewBag.Title = "Returns";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Returns</h2>


<form id="newRental" action="">
    <div class="form-group">
        <label>Customer</label>
        <div class="tt-container">
            <input name="customer"id="customer" data-rule-validCustomer="true" required type="text" value="" class="form-control"/>
        </div>
    </div>
       
    
    
    <div  class="form-group">
        <ul id="movies" class="list-group">
           
        </ul>



    </div>
    <div class="form-group">
        <div class="row">
            <button class="btn btn-primary">Submit</button>
        </div>
    </div>
</form>

@section scripts
{@Scripts.Render("~/bundles/jqueryval")
    <script>

        $(document).ready(function() {
            var name;
            var vm = {
                movieIds: []
            };
            var customers = new Bloodhound({
                datumTokenizer: Bloodhound.tokenizers.obj.whitespace('name'),
                queryTokenizer: Bloodhound.tokenizers.whitespace,
                //prefetch: '../data/films/post_1960.json',
                remote: {
                    url: '../api/customers?query=%QUERY',
                    wildcard: '%QUERY'
                }
            });

            $('#customer').typeahead({
                    minLength: 3,
                    highlight: true
                },
                {
                    name: 'customers',
                    display: 'name',
                    source: customers
                }).on("typeahead:select",
                function(e, customer) {
                    vm.customerId = customer.id;
                    name = customer.name;
                });


            $.validator.addMethod("validCustomer",
                function() {
                    return vm.customerId && vm.customerId !== 0;
                },
                "Please select valid customer");
            var validator = $("#newRental").validate({
                submitHandler: function() {


                    $.ajax({
                        url: "/api/Returns?customerName="+name,
                        method: "GET"

                       
                    }).done(function (dataInput) {
                        var vardateReturned = 
                        " <div class='input-group date dateReturned'><input type='text' class='form-control' />" +
                         "<span class='input-group-addon'>" +
                          " <span class='glyphicon glyphicon-calendar'></span>" +
                          "  </span>" +
                            " </div>";
                        
                        var vardateRented =     " <div class='input-group date dateRented'><input type='text' class='form-control' />" +
                                "<span class='input-group-addon'>" +
                                " <span class='glyphicon glyphicon-calendar'></span>" +
                                "  </span>" +
                                " </div>";
                       
                     // <div class="col-md-4">.col-md-4</div>
                        for (var index=0;index<dataInput.length ; index++) {
                            var dateReturn = $(".dateReturned");
                            
                           // dateReturn.val = Date.parse(dataInput[index].dateReturned.toString("dd/MM/YYYY"));
                            var dateRent = $(".dateRented");
                           // dateRent.val = Date.parse(dataInput[index].dateRented.toString("dd/MM/YYYY"));
                            $("#movies").append('<li class="list-group-item">' + dataInput[index].customer.name + '</li>');
                            $("#movies").append('<li class="list-group-item">' + dataInput[index].movie.name + '</li>');
                            $("#movies").append('<li class="list-group-item">' + dataInput[index].dateRented+ '</li>');
                            $("#movies").append('<li class="list-group-item">' + dataInput[index].dateReturned + '</li>');
                            
                            
                        }
                        $(".dateReturned").datetimepicker();
                        $(".dateRented").datetimepicker();
                       
                        
                        
                        
                        //(document).getElementById("#movies").removeChild("li");
                    }).fail(function() {
                        toastr.success("Something wrong happened");

                    });
                    return false;
                }
            });
            $(function () {
                
            });

        });


    </script>

}
